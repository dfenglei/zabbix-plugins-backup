
#!/usr/bin/env python2.7
#coding=utf-8
import json
import urllib2
# based url and required header
url = "http://127.0.0.1/zabbix/api_jsonrpc.php"
header = {"Content-Type": "application/json"}
# request json
data = json.dumps(
		{
		"jsonrpc":"2.0",
		"method":"configuration.import",
		"params":{
		"format": "xml",
	        "rules": {
			"templates": {
				"createMissing": true,
				"updateExisting": true
			},
			"groups": {
				"createMissing": true
			},
			"applications": {
				"createMissing": true,
				"updateExisting": true,
				"deleteMissing": true
			},
			"items": {
				"createMissing": true,
				"updateExisting": true,
				"deleteMissing": true
			},
			"discovery_rules": {
				"createMissing": true,
				"updateExisting": true,
				"deleteMissing": true
			}
		},
		"source": "<?xml version="1.0" encoding="UTF-8"?><zabbix_export><version>2.0</version><date>2015-08-12T02:34:40Z</date><groups><group><name>Templates</name></group></groups><templates><template><template>Template HP iLO snmp hardware monitor</template><name>Template HP iLO snmp hardware monitor</name><description/><groups><group><name>Templates</name></group></groups><applications><application><name>Service</name></application></applications><items><item><name>Fans</name><type>4</type><snmp_community>public</snmp_community><multiplier>0</multiplier><snmp_oid>.1.3.6.1.4.1.232.6.2.6.4.0</snmp_oid><key>fan.status</key><delay>300</delay><history>90</history><trends>365</trends><status>0</status><value_type>3</value_type><allowed_hosts/><units/><delta>0</delta><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><formula>1</formula><delay_flex/><params/><ipmi_sensor/><data_type>0</data_type><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><description/><inventory_link>0</inventory_link><applications><application><name>Service</name></application></applications><valuemap><name>HP Insight System Status</name></valuemap><logtimefmt/></item><item><name>Memory</name><type>4</type><snmp_community>public</snmp_community><multiplier>0</multiplier><snmp_oid>.1.3.6.1.4.1.232.6.2.14.4.0</snmp_oid><key>memory.status</key><delay>300</delay><history>90</history><trends>365</trends><status>0</status><value_type>3</value_type><allowed_hosts/><units/><delta>0</delta><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><formula>1</formula><delay_flex/><params/><ipmi_sensor/><data_type>0</data_type><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><description/><inventory_link>0</inventory_link><applications><application><name>Service</name></application></applications><valuemap><name>HP Insight System Status</name></valuemap><logtimefmt/></item><item><name>Network</name><type>4</type><snmp_community>public</snmp_community><multiplier>0</multiplier><snmp_oid>.1.3.6.1.4.1.232.11.2.10.7.0</snmp_oid><key>network.status</key><delay>300</delay><history>90</history><trends>365</trends><status>0</status><value_type>1</value_type><allowed_hosts/><units/><delta>0</delta><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><formula>1</formula><delay_flex/><params/><ipmi_sensor/><data_type>0</data_type><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><description/><inventory_link>0</inventory_link><applications><application><name>Service</name></application></applications><valuemap><name>HP Insight System Status</name></valuemap><logtimefmt/></item><item><name>Power Supplies</name><type>4</type><snmp_community>public</snmp_community><multiplier>0</multiplier><snmp_oid>.1.3.6.1.4.1.232.6.2.9.1.0</snmp_oid><key>powersupplies.status.[{#SNMPVALUE}]</key><delay>300</delay><history>90</history><trends>365</trends><status>0</status><value_type>3</value_type><allowed_hosts/><units/><delta>0</delta><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><formula>1</formula><delay_flex/><params/><ipmi_sensor/><data_type>0</data_type><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><description/><inventory_link>0</inventory_link><applications><application><name>Service</name></application></applications><valuemap><name>HP Insight System Status</name></valuemap><logtimefmt/></item><item><name>Processors</name><type>4</type><snmp_community>public</snmp_community><multiplier>0</multiplier><snmp_oid>.1.3.6.1.4.1.232.1.2.2.4.0</snmp_oid><key>processors.status</key><delay>300</delay><history>90</history><trends>365</trends><status>0</status><value_type>3</value_type><allowed_hosts/><units/><delta>0</delta><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><formula>1</formula><delay_flex/><params/><ipmi_sensor/><data_type>0</data_type><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><description/><inventory_link>0</inventory_link><applications><application><name>Service</name></application></applications><valuemap><name>HP Insight System Status</name></valuemap><logtimefmt/></item><item><name>Storage</name><type>4</type><snmp_community>public</snmp_community><multiplier>0</multiplier><snmp_oid>.1.3.6.1.4.1.232.3.1.3.0</snmp_oid><key>smartarray.status</key><delay>300</delay><history>90</history><trends>365</trends><status>0</status><value_type>3</value_type><allowed_hosts/><units/><delta>0</delta><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><formula>1</formula><delay_flex/><params/><ipmi_sensor/><data_type>0</data_type><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><description/><inventory_link>0</inventory_link><applications><application><name>Service</name></application></applications><valuemap><name>HP Insight System Status</name></valuemap><logtimefmt/></item><item><name>System Status</name><type>4</type><snmp_community>public</snmp_community><multiplier>0</multiplier><snmp_oid>.1.3.6.1.4.1.232.11.2.2.6.0</snmp_oid><key>system.status</key><delay>300</delay><history>90</history><trends>365</trends><status>0</status><value_type>4</value_type><allowed_hosts/><units/><delta>0</delta><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><formula>1</formula><delay_flex/><params/><ipmi_sensor/><data_type>0</data_type><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><description/><inventory_link>0</inventory_link><applications><application><name>Service</name></application></applications><valuemap/><logtimefmt/></item><item><name>Temperatures</name><type>4</type><snmp_community>public</snmp_community><multiplier>0</multiplier><snmp_oid>.1.3.6.1.4.1.232.6.2.6.3.0</snmp_oid><key>temperatures.status</key><delay>300</delay><history>90</history><trends>365</trends><status>0</status><value_type>3</value_type><allowed_hosts/><units/><delta>0</delta><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><formula>1</formula><delay_flex/><params/><ipmi_sensor/><data_type>0</data_type><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><description/><inventory_link>0</inventory_link><applications><application><name>Service</name></application></applications><valuemap><name>HP Insight System Status</name></valuemap><logtimefmt/></item></items><discovery_rules><discovery_rule><name>Fans_discovery</name><type>4</type><snmp_community>public</snmp_community><snmp_oid>.1.3.6.1.4.1.232.6.2.6.4</snmp_oid><key>snmp.fan.discovery</key><delay>300</delay><status>0</status><allowed_hosts/><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><delay_flex/><params/><ipmi_sensor/><authtype>0</authtype><username/><password/><publickey/><privatekey/><port/><filter><evaltype>0</evaltype><formula/><conditions/></filter><lifetime>30</lifetime><description/><item_prototypes/><trigger_prototypes/><graph_prototypes/><host_prototypes/></discovery_rule><discovery_rule><name>Memory_discovery</name><type>4</type><snmp_community>public</snmp_community><snmp_oid>.1.3.6.1.4.1.232.6.2.14.4</snmp_oid><key>snmp.memory.discovery</key><delay>300</delay><status>0</status><allowed_hosts/><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><delay_flex/><params/><ipmi_sensor/><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><filter><evaltype>0</evaltype><formula/><conditions/></filter><lifetime>30</lifetime><description/><item_prototypes/><trigger_prototypes/><graph_prototypes/><host_prototypes/></discovery_rule><discovery_rule><name>Network_discovery</name><type>4</type><snmp_community>public</snmp_community><snmp_oid>.1.3.6.1.4.1.232.11.2.10.7</snmp_oid><key>snmp.network.discovery</key><delay>300</delay><status>0</status><allowed_hosts/><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><delay_flex/><params/><ipmi_sensor/><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><filter><evaltype>0</evaltype><formula/><conditions/></filter><lifetime>30</lifetime><description/><item_prototypes/><trigger_prototypes/><graph_prototypes/><host_prototypes/></discovery_rule><discovery_rule><name>Power Supplies_discovery</name><type>4</type><snmp_community>public</snmp_community><snmp_oid>.1.3.6.1.4.1.232.6.2.9.1</snmp_oid><key>snmp.powersupply.discovery</key><delay>300</delay><status>0</status><allowed_hosts/><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><delay_flex/><params/><ipmi_sensor/><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><filter><evaltype>0</evaltype><formula/><conditions/></filter><lifetime>30</lifetime><description/><item_prototypes/><trigger_prototypes/><graph_prototypes/><host_prototypes/></discovery_rule><discovery_rule><name>Processors_discovery</name><type>4</type><snmp_community>public</snmp_community><snmp_oid>.1.3.6.1.4.1.232.1.2.2.4</snmp_oid><key>snmp.processors.discovery</key><delay>300</delay><status>0</status><allowed_hosts/><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><delay_flex/><params/><ipmi_sensor/><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><filter><evaltype>0</evaltype><formula/><conditions/></filter><lifetime>30</lifetime><description/><item_prototypes/><trigger_prototypes/><graph_prototypes/><host_prototypes/></discovery_rule><discovery_rule><name>Storage_discovery</name><type>4</type><snmp_community>public</snmp_community><snmp_oid>.1.3.6.1.4.1.232.3.1.3</snmp_oid><key>snmp.smartarray.discovery</key><delay>300</delay><status>0</status><allowed_hosts/><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><delay_flex/><params/><ipmi_sensor/><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><filter><evaltype>0</evaltype><formula/><conditions/></filter><lifetime>30</lifetime><description/><item_prototypes/><trigger_prototypes/><graph_prototypes/><host_prototypes/></discovery_rule><discovery_rule><name>Temperatures_discovery</name><type>4</type><snmp_community>public</snmp_community><snmp_oid>.1.3.6.1.4.1.232.6.2.6.3</snmp_oid><key>snmp.temperatures.discovery</key><delay>300</delay><status>0</status><allowed_hosts/><snmpv3_contextname/><snmpv3_securityname/><snmpv3_securitylevel>0</snmpv3_securitylevel><snmpv3_authprotocol>0</snmpv3_authprotocol><snmpv3_authpassphrase/><snmpv3_privprotocol>0</snmpv3_privprotocol><snmpv3_privpassphrase/><delay_flex/><params/><ipmi_sensor/><authtype>0</authtype><username/><password/><publickey/><privatekey/><port>161</port><filter><evaltype>0</evaltype><formula/><conditions/></filter><lifetime>30</lifetime><description/><item_prototypes/><trigger_prototypes/><graph_prototypes/><host_prototypes/></discovery_rule></discovery_rules><macros/><templates/><screens/></template></templates></zabbix_export>"
	
	},
	"auth":"e65e2b4428797bc22f4a6a657bdde47a", # the auth id is what auth script returns, remeber it is string
	"id":1,
	})
	# create request object
request = urllib2.Request(url,data)
for key in header:
	request.add_header(key,header[key])
	# get host list
try:
	result = urllib2.urlopen(request)
except urllib2.URLError as e:
	if hasattr(e, 'reason'):
		print 'We failed to reach a server.'
		print 'Reason: ', e.reason
	elif hasattr(e, 'code'):
			print 'The server could not fulfill the request.'
			print 'Error code: ', e.code
else:
	response = json.loads(result.read())
	result.close()
	print "Number Of Hosts: ", len(response['result'])
	for host in response['result']:
		print "Host ID:",host['hostid'],"Host Name:",host['name']
